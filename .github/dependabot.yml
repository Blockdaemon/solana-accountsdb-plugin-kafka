version: 2
updates:
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "daily"

  # Monitor main branch for development dependencies (allows 3.x upgrades)
  - package-ecosystem: "cargo"
    directory: "/"
    schedule:
      interval: "daily"
    # Main branch can accept all updates including major versions
    # Allow updates within 3.x range, prevent 4.x upgrades
    allow:
      # Allow updates within major version 3.x for Agave ecosystem
      - dependency-name: "agave-geyser-plugin-interface"
      # Allow updates within major version 3.x for Solana ecosystem
      - dependency-name: "solana-*"
      # Allow all other dependency updates
      - dependency-name: "*"
    # Prevent major version upgrades that could break compatibility
    ignore:
      # Block Agave 4.x upgrades (would break ABI compatibility)
      - dependency-name: "agave-geyser-plugin-interface"
        versions: [">=4.0.0"]
      # Block Solana 3.x upgrades (would break compatibility)
      - dependency-name: "solana-*"
        versions: [">=4.0.0"]
      # Pinned for Rust 1.86 on v3.1; vergen 9.1.0+ and time 0.3.45+ require rustc 1.88
      - dependency-name: "vergen"
        versions: [">=9.0.7"]
      - dependency-name: "time"
        versions: [">=0.3.45"]
    # Group related updates together
    groups:
      agave-updates:
        patterns:
          - "agave-*"
        update-types:
          - "patch"
          - "minor"
      solana-updates:
        patterns:
          - "solana-*"
        update-types:
          - "patch"
          - "minor"
      other-updates:
        exclude-patterns:
          - "agave-*"
          - "solana-*"
