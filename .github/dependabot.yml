version: 2
updates:
  # Monitor main branch for development dependencies (allows 3.x upgrades)
  - package-ecosystem: "cargo"
    directory: "/"
    schedule:
      interval: "daily"
    # Main branch can accept all updates including major versions
    groups:
      agave-updates:
        patterns:
          - "agave-*"
      solana-updates:
        patterns:
          - "solana-*"
      other-updates:
        patterns:
          - "*"
        exclude-patterns:
          - "agave-*"
          - "solana-*"

  # Monitor v2.3 branch for production dependencies (restricts to 2.x)
  - package-ecosystem: "cargo"
    directory: "/"
    schedule:
      interval: "daily"
    target-branch: "v2.3"
    # Allow updates within 2.x range, prevent 3.x upgrades
    allow:
      # Allow updates within major version 2.x for Agave ecosystem
      - dependency-name: "agave-geyser-plugin-interface"
      # Allow updates within major version 2.x for Solana ecosystem
      - dependency-name: "solana-*"
      # Allow all other dependency updates
      - dependency-name: "*"
    # Prevent major version upgrades that could break compatibility
    ignore:
      # Block Agave 3.x upgrades (would break ABI compatibility)
      - dependency-name: "agave-geyser-plugin-interface"
        versions: [">=3.0.0"]
      # Block Solana 3.x upgrades (would break compatibility)
      - dependency-name: "solana-*"
        versions: [">=3.0.0"]
    # Group related updates together
    groups:
      agave-updates:
        patterns:
          - "agave-*"
        update-types:
          - "patch"
          - "minor"
      solana-updates:
        patterns:
          - "solana-*"
        update-types:
          - "patch"
          - "minor"
      other-updates:
        patterns:
          - "*"
        exclude-patterns:
          - "agave-*"
          - "solana-*"
